erDiagram
    %% Core Entity Tables
    STOCKS {
        bigint stock_id PK "Auto-increment primary key"
        varchar symbol UK "Stock symbol (e.g., RELIANCE)"
        varchar company_name "Full company name"
        varchar isin UK "ISIN code"
        varchar sector "Business sector"
        varchar industry "Industry classification"
        bigint market_cap "Market capitalization"
        varchar exchange "NSE/BSE"
        boolean is_active "Active trading status"
        datetime created_at
        datetime updated_at
    }

    %% Fundamental Data (Updated Daily)
    FUNDAMENTALS {
        bigint fundamental_id PK
        bigint stock_id FK
        date data_date UK "Date of the data"
        decimal pe_ratio "Price/Earnings ratio"
        decimal pb_ratio "Price/Book ratio"
        decimal ps_ratio "Price/Sales ratio"
        decimal peg_ratio "Price/Earnings to Growth"
        decimal dividend_yield "Dividend yield %"
        decimal eps "Earnings Per Share"
        decimal eps_growth_yoy "EPS growth year-over-year"
        decimal eps_growth_3y "EPS growth 3-year"
        decimal eps_growth_5y "EPS growth 5-year"
        decimal revenue_growth_yoy "Revenue growth YoY"
        decimal revenue_growth_3y "Revenue growth 3-year"
        decimal revenue_growth_5y "Revenue growth 5-year"
        decimal net_profit_margin "Net profit margin %"
        decimal ebitda_margin "EBITDA margin %"
        decimal roe "Return on Equity %"
        decimal roce "Return on Capital Employed %"
        decimal debt_equity_ratio "Debt to Equity ratio"
        decimal interest_coverage_ratio
        decimal current_ratio
        decimal quick_ratio
        bigint free_cash_flow "Free cash flow"
        bigint cash_flow_operations "Cash flow from operations"
        decimal promoter_holding "Promoter holding %"
        decimal institutional_holding "Institutional holding %"
        decimal asset_turnover_ratio
        decimal inventory_turnover_ratio
        decimal receivables_turnover_ratio
        decimal working_capital_turnover
        decimal altman_z_score "Altman Z-score"
        decimal piotroski_score "Piotroski score"
        datetime created_at
        datetime updated_at
    }

    %% Price Data (OHLCV - Updated Daily)
    PRICE_DATA {
        bigint price_id PK
        bigint stock_id FK
        date trading_date UK "Trading date"
        decimal open_price "Opening price"
        decimal high_price "Day high"
        decimal low_price "Day low"
        decimal close_price "Closing price"
        decimal adjusted_close "Adjusted closing price"
        bigint volume "Trading volume"
        decimal vwap "Volume weighted average price"
        datetime created_at
    }

    %% Technical Indicators (Calculated Daily)
    TECHNICAL_INDICATORS {
        bigint technical_id PK
        bigint stock_id FK
        date calculation_date UK "Date of calculation"
        decimal sma_20 "20-day Simple Moving Average"
        decimal sma_50 "50-day Simple Moving Average"
        decimal sma_200 "200-day Simple Moving Average"
        decimal ema_20 "20-day Exponential Moving Average"
        decimal ema_50 "50-day Exponential Moving Average"
        decimal ema_200 "200-day Exponential Moving Average"
        decimal wma_20 "20-day Weighted Moving Average"
        decimal rsi "Relative Strength Index"
        decimal stochastic_k "Stochastic %K"
        decimal stochastic_d "Stochastic %D"
        decimal cci "Commodity Channel Index"
        decimal roc "Rate of Change"
        decimal williams_r "Williams %R"
        decimal macd_line "MACD line"
        decimal macd_signal "MACD signal line"
        decimal macd_histogram "MACD histogram"
        decimal adx "Average Directional Index"
        decimal parabolic_sar "Parabolic SAR"
        decimal aroon_up "Aroon Up"
        decimal aroon_down "Aroon Down"
        decimal supertrend "Supertrend value"
        decimal bb_upper "Bollinger Band Upper"
        decimal bb_lower "Bollinger Band Lower"
        decimal bb_width "Bollinger Band Width"
        decimal atr "Average True Range"
        decimal standard_deviation "Standard Deviation"
        decimal donchian_high "Donchian Channel High"
        decimal donchian_low "Donchian Channel Low"
        decimal obv "On-Balance Volume"
        decimal ad_line "Accumulation/Distribution Line"
        decimal cmf "Chaikin Money Flow"
        decimal volume_ma_20 "20-day Volume Moving Average"
        decimal week_52_high "52-week high"
        decimal week_52_low "52-week low"
        datetime created_at
    }

    %% Support/Resistance and Pivot Points
    PIVOT_SUPPORT_RESISTANCE {
        bigint psr_id PK
        bigint stock_id FK
        date calculation_date UK
        decimal pivot_classic "Classic Pivot Point"
        decimal support_1_classic "Classic Support 1"
        decimal support_2_classic "Classic Support 2"
        decimal resistance_1_classic "Classic Resistance 1"
        decimal resistance_2_classic "Classic Resistance 2"
        decimal pivot_fibonacci "Fibonacci Pivot Point"
        decimal support_1_fib "Fibonacci Support 1"
        decimal resistance_1_fib "Fibonacci Resistance 1"
        decimal fib_23_6 "Fibonacci 23.6% level"
        decimal fib_38_2 "Fibonacci 38.2% level"
        decimal fib_50_0 "Fibonacci 50.0% level"
        decimal fib_61_8 "Fibonacci 61.8% level"
        datetime created_at
    }

    %% Candlestick Patterns (Detected Daily)
    CANDLESTICK_PATTERNS {
        bigint pattern_id PK
        bigint stock_id FK
        date detection_date UK
        varchar pattern_name "Name of the pattern"
        varchar pattern_type "Bullish/Bearish/Neutral"
        decimal confidence_score "Pattern confidence (0-1)"
        varchar timeframe "1D, 1W, 1M"
        datetime created_at
    }

    %% Gap Analysis
    GAP_ANALYSIS {
        bigint gap_id PK
        bigint stock_id FK
        date gap_date UK
        varchar gap_type "Gap Up/Gap Down"
        decimal gap_percentage "Gap size in %"
        decimal gap_size "Absolute gap size"
        decimal previous_close "Previous day close"
        decimal current_open "Current day open"
        boolean gap_filled "Whether gap was filled"
        datetime created_at
    }

    %% Data Sources Tracking
    DATA_SOURCES {
        int source_id PK
        varchar source_name UK "Name of data source"
        varchar source_type "API/File/Manual"
        varchar base_url "API base URL if applicable"
        boolean is_active "Active status"
        varchar update_frequency "Daily/Hourly/Real-time"
        datetime last_update "Last successful update"
        datetime created_at
    }

    %% Data Update Log
    DATA_UPDATE_LOG {
        bigint log_id PK
        int source_id FK
        varchar table_name "Table that was updated"
        date data_date "Date of the data updated"
        int records_processed "Number of records"
        int records_success "Successfully processed"
        int records_failed "Failed records"
        varchar status "SUCCESS/FAILED/PARTIAL"
        text error_details "Error details if any"
        datetime start_time "Update start time"
        datetime end_time "Update end time"
        datetime created_at
    }

    %% Screener Cache (for fast query responses)
    SCREENER_CACHE {
        bigint cache_id PK
        varchar cache_key UK "Unique cache identifier"
        text query_hash "Hash of the screener query"
        json result_data "Cached results in JSON"
        datetime data_as_of "Data timestamp"
        datetime expires_at "Cache expiry time"
        int hit_count "Number of times accessed"
        datetime created_at
        datetime last_accessed
    }

    %% User Watchlists (Optional for future)
    USER_WATCHLISTS {
        bigint watchlist_id PK
        varchar user_id "User identifier"
        varchar watchlist_name "Custom watchlist name"
        json stock_list "Array of stock_ids"
        boolean is_default "Default watchlist flag"
        datetime created_at
        datetime updated_at
    }

    %% Relationships
    STOCKS ||--o{ FUNDAMENTALS : "has daily fundamentals"
    STOCKS ||--o{ PRICE_DATA : "has daily prices"
    STOCKS ||--o{ TECHNICAL_INDICATORS : "has technical data"
    STOCKS ||--o{ PIVOT_SUPPORT_RESISTANCE : "has pivot points"
    STOCKS ||--o{ CANDLESTICK_PATTERNS : "has patterns"
    STOCKS ||--o{ GAP_ANALYSIS : "has gaps"
    DATA_SOURCES ||--o{ DATA_UPDATE_LOG : "tracks updates"
    STOCKS ||--o{ USER_WATCHLISTS : "in watchlists" 